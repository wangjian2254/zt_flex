<?xml version="1.0" encoding="utf-8"?>
<control:CBorderContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
						  xmlns:s="library://ns.adobe.com/flex/spark" 
						  xmlns:mx="library://ns.adobe.com/flex/mx" xmlns:control="control.*" borderVisible="false" backgroundAlpha="0" width="900" height="300" xmlns:uicontrol="uicontrol.*" >
	<control:layout>
		<s:BasicLayout/>
	</control:layout>
	<fx:Script>
		<![CDATA[
			import events.CloseEvent;
			
			import httpcontrol.RemoteUtil;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.controls.advancedDataGridClasses.AdvancedDataGridColumn;
			import mx.controls.advancedDataGridClasses.AdvancedDataGridColumnGroup;
			import mx.events.CollectionEvent;
			import mx.events.FlexEvent;
			import mx.events.ItemClickEvent;
			import mx.formatters.DateFormatter;
			import mx.rpc.AbstractOperation;
			import mx.rpc.events.ResultEvent;
			import mx.utils.ObjectUtil;
			import mx.utils.StringUtil;
			
			import spark.components.CheckBox;
			
			import util.DateUtil;
			import util.InfoUtil;
			[Bindable]
			public var showLabel:String;
			
			override public function init(e:FlexEvent):void{

			}
			
			override public function closeContainer(e:CloseEvent):void{
				dispatchEvent(e);
				
			}
			
			
		
//					grid.invalidateList();
			

			
			public function orderRuningRefresh():void{
				//				bbchange(null);
				var myDateFormatter:DateFormatter=new DateFormatter();
				myDateFormatter.formatString="YYYYMMDD";
				myDateFormatter.format(new Date());
				if(startdate.selectedDate==null||enddate.selectedDate==null){
					Alert.show("订单下达日期必须选择","提示");
					return;
				}
				var start:String=myDateFormatter.format(startdate.selectedDate);	
				var end:String=myDateFormatter.format(enddate.selectedDate);
				var open:String="close";
				if(cbopen.selected){
					open="open";
				}
				var op:AbstractOperation=RemoteUtil.getOperation("getOrderRuningList");
				op.addEventListener(ResultEvent.RESULT,resultOrderRuningList);
				RemoteUtil.openLoading();
				op.send(start,end,open);
			}
			
			public function resultOrderRuningList(e:ResultEvent):void{
				
			}
			
			
			public function setDateRange(type:String):void{
				var end:Date=new Date();
				var start:Date=new Date();
				switch(type){
					case "oneweek":
						start.date-=7;
						break;
					case "twoweek":
						start.date-=14;
						break;
					case "onemonth":
						start.date-=31;
						break;
					case "twomonth":
						start.date-=62;
						break;
				}
				startdate.selectedDate=start;
				enddate.selectedDate=end;
			}
			
			
			
			
			
			[Bindable]
			public var doflag:Boolean=false;
			
			[Bindable]
			public var query:ArrayCollection=new ArrayCollection();
			
			[Bindable]
			public var orderisopenlist:ArrayCollection=new ArrayCollection();
			
			[Bindable]
			public var orderbb:ArrayCollection=new ArrayCollection();
			
			
			public var orderAndCodeMap:Object=new Object();
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
		<s:RadioButtonGroup id="ddquerytype" >
			
		</s:RadioButtonGroup>
	</fx:Declarations>
	<s:HGroup top="8" right="8" bottom="8" left="8" gap="7">
		
		<s:BorderContainer width="100%" height="100%"  borderVisible="false" color="0x333333" skinClass="skins.contentBoxSkin">	
			<s:layout>
				<s:VerticalLayout gap="5" paddingTop="5" paddingLeft="5" paddingRight="5">
					
				</s:VerticalLayout>
			</s:layout>
			<s:BorderContainer left="0" top="0" height="45" width="100%" borderVisible="false" backgroundImage="{CBorderContainer.toolbgimg}">
				<s:layout>
					<s:HorizontalLayout gap="10" verticalAlign="middle" paddingLeft="20">
						
					</s:HorizontalLayout>
				</s:layout>
				<s:RadioButton id="cbclose" groupName="order" label="已关闭订单" />
				<s:RadioButton id="cbopen" groupName="order"  label="未关闭订单" selected="true" />
				
				
				<s:Label text="下达日期:">
					
				</s:Label>
				<mx:DateField id="startdate" width="100" dayNames="{DateUtil.dayNames}" monthNames="{DateUtil.monthNames}" />
				<s:Label text="~"/>
				<mx:DateField id="enddate" width="100" dayNames="{DateUtil.dayNames}" monthNames="{DateUtil.monthNames}" />
				<s:Button label="一周内" click="setDateRange('oneweek');">
				</s:Button>
				<s:Button label="两周内" click="setDateRange('twoweek');">
				</s:Button>
				<s:Button label="一月内" click="setDateRange('onemonth');">
				</s:Button>
				<s:Button label="两月内" click="setDateRange('twomonth');">
				</s:Button>
				<s:Button label="查询" click="orderRuningRefresh()">
				</s:Button>
				
			</s:BorderContainer>
			<s:Scroller width="100%" height="100%">
				<s:Group width="100%" height="100%">
					<mx:AdvancedDataGrid id="grid" dataProvider="{query}" visible="false" editable="true"  height="100%">
						<mx:groupedColumns>
							<mx:AdvancedDataGridColumn headerText="选择" dataField="selected"  sortable="false" width="60"  editorDataField="selected" rendererIsEditor="true" >
								<mx:itemRenderer>
									<fx:Component>
										<mx:HBox horizontalAlign="center">
											<fx:Script>
												<![CDATA[
													public function get selected():Boolean{
														return cb.selected;
													}
													public function set selected(value:Boolean):void{
														cb.selected=value;
													}
												]]>
											</fx:Script>
											
											<mx:CheckBox id="cb" selected="{data.selected}" >
												
											</mx:CheckBox>
										</mx:HBox>
									</fx:Component>
								</mx:itemRenderer>
							</mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="订单号" width="120">
							</mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="下达日期" width="100"></mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="录入" width="120"></mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="项数" width="60"></mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="件数" width="60"></mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="已关闭项数" width="120"></mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="未关闭项数" width="120"></mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="关闭标记" width="120"></mx:AdvancedDataGridColumn>
							<mx:AdvancedDataGridColumn headerText="未关闭时间" width="120"></mx:AdvancedDataGridColumn>
						</mx:groupedColumns>
					</mx:AdvancedDataGrid>	
				</s:Group>
			</s:Scroller>
			
			
		</s:BorderContainer>
	</s:HGroup>
	<uicontrol:CProgressBar id="bar" width="100%" height="100%" visible="false">
	</uicontrol:CProgressBar>
</control:CBorderContainer>
